import "tfplan"

valid_regions = {"production": "us-west-1", "staging": "us-east-1"}

is_not_aws = func(type) {
	return type is not "aws"
}

validate_region = func(provider) {
	for provider.alias as k, v {
		if v.config.region is not valid_regions[tfplan.variables.env] {
			print(v.config.region, valid_regions[tfplan.variables.env])
			return false
		}
	}

	return true
}

main = rule {
	all tfplan.config.providers as k, v {
		is_not_aws(k) or validate_region(v)
	}
}
